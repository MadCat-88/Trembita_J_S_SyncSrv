# Проект SOAP Web-сервіса на Spring Framework з підтримкою системи Трембіта

## Опис
Цей проєкт входить в набір прикладів взаємодії з API шлюзу безпечного обміну системи Трембіта (ШБО), що демонструють технічні особливості розробки вебсервісів та вебклієнтів, сумісних з системою Трембіта.
Даний проєкт представляє опис створення сумісного SOAP-сервісу на мові програмування Java з використанням фрейморка Spring. Spring - це сучасний, швидкий (високопродуктивний) фреймворк для Java.\
Приклад описує отримання з умовної бази даних (реєстру) відомостей про інформаційні об'єкти (у прикладі об'єктом є користувач) та управління їх статусом, у тому числі обробку запитів на пошук, отримання, створення, редагування та видалення об'єктів через SOAP API, що доступне через систему Трембіта.\
Проєкт демонструє:
- Cтандартні синхронні та асинхронні виклики
- Роботу з БД PostgreSQL (функції додавання, пошуку, оновлення та видалення об'єктів)
- Логування роботу застосунку з налаштуванням деталізації
- Роботу з файлом конфігурації
- Підтримку системи Трембіта (логування заголовків).

## Вимоги
- Java 17+
- Git (для клонування репозиторію)
- PostgreSQL 14.12
- Ubuntu Server 22.04

## Встановлення

### Встановлення за допомогою скрипта install_SpringWSoap.sh

Було створено скрипт `install_SpringWSoap.sh` для автоматизації процесу встановлення середовища розробки, готового до компіляції прикладу. Скрипт виконує наступні кроки:
1. Встановлює системні залежності.
2. Клонує репозиторій.
3. Встановлює або оновлює Java 21.
4. Встановлює та налаштовує базу даних PostgreSQL 14.12.
5. Завантажує та налаштовує середовище розробки Apache NetBeans 19.

#### Використання скрипта install_SpringWSoap.sh

На вашій робочій станції для розробки виконайте наступні кроки:
1. Завантажте скрипт автоматизациї встановлення `install_SpringWSoap.sh` в папку Documents:
   ```bash
   wget https://raw.githubusercontent.com/Wishmaster-sa/SpringWSsoap/master/install_SpringWSoap.sh
   ```

2. Зробіть файл виконуваним:

   ```bash
   sudo chmod +x install_SpringWSoap.sh
   ```

3. Запустіть скрипт:

   ```bash
   sudo bash ./install_SpringWSoap.sh
   ```
4. Надайте відповідь на запитання скрипту щодо імені бази даних, яка буде використовуватись для проєкту, імені користувача бази даних, пароля користувача БД (Скрипт сам створить БД, створить роль та встановить вказаний вами пароль).

5. В деяких випадках скрипт може пропонувати перезавантажити деякі системні служби - просто натисніть Enter.

6. Після завершення процесу налаштування запустить сервіс командою:
   ```bash
   cd SpringWSsoap/ || java -jar ./target/SpringWSoap-0.0.1-SNAPSHOT.jar
   ```
після того як сервіс запуститься ви зможете подивитись його по адресу: 

http://ваш_IP_адрес:8080/

7. Якщо ви бажаєте налаштувати щоб веб-сервіс запускався автоматично після перезапуску системи, то виконайте наступну команду (ви повинні знаходитись в каталогі з сервісом SpringWSsoap):
   ```bash
   bash springws-service.sh install
   ```
   
### Ручне встановлення

#### Оновлення списку доступних пакетів програмного забезпечення з офіційних репозиторіїв 

```bash
sudo apt update
```

#### Встановлення Java JDK 21

```bash
sudo apt install openjdk-21-jdk 
```

#### Створення БД. Цей сервіс використовує PostgreSQL. Створіть базу даних та користувача на сервері СКБД.

   ```bash
   sudo apt install postgresql postgresql-contrib
   ```

#### Налаштування бази даних PostgreSQL

Оберіть назву та створіть бази даних, логін та пароль користувача для підключення до неї. Ці параметри також мають бути задані у відповідному файлі конфігурації застосунку Spring - application.settings.
   ```bash
   sudo -i -u postgres psql
   ```
   ```
   CREATE DATABASE db_spring;
   ```

   ```
   CREATE ROLE spring LOGIN PASSWORD 'pass';
   ```

   ```
   GRANT ALL PRIVILEGES ON DATABASE db_spring TO spring;
   ```

Для вихода з командного рядку БД psql введіть \q

#### Завантажити та встановити середовище розробки Apache NetBeans ви можете через браузер, або через додаток Ubuntu Software, або якщо використовується командний рядок за допомогою наступної команди:
   ```bash
   curl https://archive.apache.org/dist/netbeans/netbeans-installers/19/apache-netbeans_19-1_all.deb --output apache-netbeans_19-1_all.deb
   ```
та

   ```bash
   sudo dpkg -i apache-netbeans_19-1_all.deb
   ```
   

#### Завантажити Github клієнт

   ```bash
   sudo apt install git
   ```

#### Клонування репозиторію

```bash
git clone https://github.com/Wishmaster-sa/SpringWSsoap.git
```

#### Налаштування підключення до БД в проєкті

Відкрити файл конфігурації застосунку Spring `./SpringWSsoap/config/external-config.properties` 

```bash
nano SpringWSsoap/config/external-config.properties
```

та встановити коректні параметри підключення до БД - ім'я бази, ім'я та пароль користувача згідно значень, заданих на [кроці налаштування бази даних PostgreSQL](#налаштування-бази-даних-postgresql). 
Наприклад:

```
spring.datasource.url=jdbc:postgresql://localhost:5432/dbname
spring.datasource.username=dbusername
spring.datasource.password=dbuserpassword
```
### Переходимо до каталогу з проєктом
   ```bash
   cd SpringWSsoap
   ```

### Компілюємо вихідний файл

   ```bash
   /usr/lib/apache-netbeans/java/maven/bin/mvn package
   ```

### Запуск сервісу (ви повинні знаходитись в каталозі з сервісом SpringWSsoap)

   ```bash
   java -jar ./target/SpringWSoap-0.0.1-SNAPSHOT.jar
   ```

Сервіс запуститься і буде очікувати на вхідні мережеві з'єднання на порту 8080 за адресою
http://localhost:8080/ws/

Тут `SpringWSoap-0.0.1-SNAPSHOT.jar` - це ім'я скомпільованого файлу проєкту. Відкрийте браузер і перейдіть за адресою http://[адреса серверу]:8080.


## Документація

Після запуску сервісу ви можете отримати доступ до автоматичної документації API за наступними адресами:

- Doc: http://[адреса серверу]:8080/
- WSDL-файл: http://[адреса серверу]:8080/ws/persons.wsdl

## Налаштування як системної служби systemd

Для цілей швидкого запуску сервісу ми додаємо скрипт `springwsoap-service.sh` для автоматизації процесу встановленя веб-додатка як системної служби, та його видалення та очищення системи.

### Використання скрипта springwsoap-service.sh
1. Зробіть скріпт виконуваним:

   ```bash
   chmod +x springwsoap-service.sh
   ```

2. Запустіть скрипт з каталогу SpringWSsoap:

   ```bash
   sudo bash springwsoap-service.sh install
   ```

Скрипт автоматично вcтановить скомпільований jar як системну службу.

Якщо ви бажаєте видалити сервіс з переліку системних служб, то виконайте команду
   ```bash
   sudo bash springwsoap-service.sh remove
   ```
Скрипт автоматично зупинить та видалить системну службу та відповідні залежності.

Запустити сервіс
   ```bash
   sudo bash springwsoap-service.sh start
   ```
Припинити сервіс
   ```bash
   sudo bash springwsoap-service.sh stop
   ```
Якщо ви виконаєте файл без аргументів командного рядку, то вам буде запропоновано меню з наступними опціями:
1) Встановити сервіс
2) Запустити сервіс
3) Припинити сервіс
4) Видалити сервіс
5) Вихід

## Наповнення бази даних тестовими записами
Для цілей швидкого розгортання та використання сервісу ми додаємо Python-скрипт, який дозволяє швидко згенерувати
необхідну кількість записів в БД.

### Встановимо python (якщо він у вас вже є, то цей пункт можно пропустити)
   ```bash
   sudo apt install python3 python3-pip -y
   ```

### Встановимо біліотеку Faker яка вміє генерувати випадкові ФІО та інше.
   ```bash
   python3 -m pip install faker
   ```

### Запустим наповнення бази даних (у вас повинен бути вже запущений SpringWSrest сервіс)
   ```python
   python3 fill_fakerdb_soap.py 100
   ```
де 100 - кількість об'єктів (користувачів), яка буде згенерована та додана до БД. Ви можете встановити іншу кількість записів.


## Ліцензія

Цей проєкт ліцензується відповідно до умов MIT License.
